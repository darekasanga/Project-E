<!doctype html>
<html lang="ja">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Emperor News — 公開ビュー</title>
<style>
  :root {
    --bg: #050505;
    --panel: #0a0a0a;
    --text: #f6f6f6;
    --muted: #a1a1aa;
    --line: #06c755;
    --accent: #1a1a1a;
    --border: #1f1f1f;
    --radius: 18px;
    --shadow: 0 18px 50px rgba(0,0,0,0.45);
  }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: "SF Pro Display", "Inter", "Noto Sans JP", system-ui, sans-serif;
    background: radial-gradient(160% 140% at 20% 20%, rgba(6,199,85,0.12), transparent),
                radial-gradient(120% 120% at 80% 0%, rgba(6,199,85,0.08), transparent),
                var(--bg);
    color: var(--text);
  }
  a { color: inherit; }
  header {
    position: sticky;
    top: 0;
    z-index: 10;
    backdrop-filter: blur(12px);
    background: rgba(5,5,5,0.9);
    border-bottom: 1px solid var(--border);
    padding: 14px 18px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
  }
  .brand { display: flex; align-items: center; gap: 10px; }
  .logo {
    width: 40px; height: 40px;
    border-radius: 14px;
    border: 1px solid var(--border);
    display: grid; place-items: center;
    background: linear-gradient(145deg, #0d0d0d, #0a0a0a);
    color: var(--line);
    font-weight: 700;
  }
  .brand h1 { margin: 0; font-size: 18px; letter-spacing: 0.01em; }
  .brand p { margin: 2px 0 0; color: var(--muted); font-size: 12px; }
  .pill {
    padding: 9px 14px;
    border-radius: 999px;
    border: 1px solid var(--border);
    background: var(--accent);
    text-decoration: none;
    font-size: 13px;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }
  .pill.primary { background: var(--line); color: #041902; font-weight: 700; border-color: #0f2f14; }

  main { padding: 22px 18px 48px; display: grid; gap: 20px; }
  .hero {
    background: linear-gradient(135deg, rgba(6,199,85,0.18), rgba(6,199,85,0.05) 32%, rgba(12,12,12,0.9) 100%);
    border: 1px solid var(--border);
    border-radius: 26px;
    padding: 20px;
    display: grid;
    gap: 12px;
    box-shadow: var(--shadow);
  }
  .hero h2 { margin: 0; font-size: 22px; }
  .hero p { margin: 0; color: var(--muted); line-height: 1.6; }
  .hero .cta-row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
  .mini-pill { font-size: 12px; padding: 6px 10px; border-radius: 999px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: var(--muted); }

  .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 14px; }
  .card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 14px;
    display: grid;
    gap: 10px;
    box-shadow: 0 12px 32px rgba(0,0,0,0.3);
    transition: transform 220ms ease, border-color 200ms ease;
  }
  .card:hover { transform: translateY(-4px); border-color: rgba(6,199,85,0.4); }
  .card h3 { margin: 0; font-size: 17px; letter-spacing: 0.01em; }
  .card p { margin: 0; color: var(--muted); line-height: 1.6; }
  .meta { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; color: var(--muted); font-size: 12px; }
  .tag { padding: 6px 10px; border-radius: 999px; border: 1px solid var(--border); background: #0c0c0c; }
  .hero-img { width: 100%; border-radius: 14px; aspect-ratio: 16 / 9; object-fit: cover; border: 1px solid var(--border); }

  .share-row { display: flex; gap: 8px; flex-wrap: wrap; }
  .share { padding: 8px 12px; border-radius: 10px; border: 1px solid var(--border); background: #0c0c0c; text-decoration: none; font-size: 13px; display: inline-flex; align-items: center; gap: 6px; }
  .share.line { background: var(--line); color: #041902; font-weight: 700; border-color: #0f2f14; }

  .ticker { display: flex; gap: 10px; overflow: hidden; border: 1px solid var(--border); border-radius: 14px; background: #080808; padding: 8px 10px; }
  .ticker-track { display: flex; gap: 10px; animation: marquee 26s linear infinite; }
  .chip { padding: 7px 12px; border-radius: 999px; border: 1px solid var(--border); background: #0d0d0d; color: var(--muted); white-space: nowrap; }

  @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
  @media (max-width: 680px) {
    header { flex-direction: column; align-items: flex-start; }
    .brand { width: 100%; }
  }
</style>
<body>
  <header>
    <div class="brand">
      <div class="logo">E</div>
      <div>
        <h1>Emperor News</h1>
        <p>公開ビュー / LINE公式アカウント向け</p>
      </div>
    </div>
    <div class="actions">
      <a class="pill" href="/">トップ</a>
      <a class="pill primary" href="/blog.html" data-requires-auth="true">編集・アップロード</a>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="mini-pill">公開ページ</div>
      <h2>読者向けのシンプル配信ビュー</h2>
      <p>ChatGPTからアップロードした記事をそのまま公開。黒基調のモバイル最適化カードで、公式LINEアカウントにもシェアできます。リンクだけで友だち追加と記事閲覧を両立。</p>
      <div class="cta-row">
        <a class="pill primary" id="openLine" rel="noreferrer">公式LINEで読む</a>
        <a class="pill" href="/blog.html#upload" data-requires-auth="true">記事を投稿する</a>
      </div>
      <div class="cta-row" id="metaInfo"></div>
    </section>

    <div class="ticker" aria-hidden="true">
      <div class="ticker-track" id="ticker"></div>
      <div class="ticker-track" id="tickerClone"></div>
    </div>

    <section class="grid" id="feed"></section>
  </main>

<script>
  const officialLinePage = "https://page.line.me/projecte_official";
  const adminSessionKey = "emperor_admin_token";
  const feedEl = document.getElementById("feed");
  const ticker = document.getElementById("ticker");
  const tickerClone = document.getElementById("tickerClone");
  const metaInfo = document.getElementById("metaInfo");

  const baseArticles = [
    {
      title: "iPadスクロール特集 — 公式LINEで読む",
      body: "黒背景とオーバースクロールを活かしたカードレイアウト。公式LINEアカウントへの配信リンクを同梱。",
      tags: ["iPad", "Scroll", "LINE公式"],
      image: "https://images.unsplash.com/photo-1472289065668-ce650ac443d2?auto=format&fit=crop&w=1200&q=80",
    },
    {
      title: "ChatGPTから即公開",
      body: "チャットで生成した原稿をそのまま貼り付け。タグとカバーを足すだけで読者向けカードを生成します。",
      tags: ["ChatGPT", "Workflow"],
      image: "https://images.unsplash.com/photo-1507138451611-3001135909a5?auto=format&fit=crop&w=1200&q=80",
    },
    {
      title: "LINEシェアリンクをワンクリック",
      body: "公式LINEアカウントと連動した共有ボタンを自動生成。外部ブラウザでも快適に閲覧できるOGP調整済み。",
      tags: ["LINE", "Share", "OGP"],
      image: "https://images.unsplash.com/photo-1508766206392-8bd5cf550d1b?auto=format&fit=crop&w=1200&q=80",
    }
  ];

  function buildOfficialLineShare(url) {
    return `https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(url)}&accountId=@projecte_official`;
  }

  function loadArticles() {
    const saved = localStorage.getItem("emperor_articles");
    return saved ? JSON.parse(saved) : baseArticles;
  }

  function renderTicker(tags) {
    const unique = Array.from(new Set(tags.length ? tags : ["iPhone", "iPad", "公式LINE", "黒ベース", "ChatGPTアップロード"]));
    const chips = unique.map(tag => `<div class="chip">#${tag}</div>`).join("");
    ticker.innerHTML = chips;
    tickerClone.innerHTML = chips;
  }

  function renderMeta(count) {
    metaInfo.innerHTML = `
      <span class="mini-pill">公開中 ${count} 件</span>
      <span class="mini-pill">LINE連携中</span>
    `;
  }

  function enforceAdminLinks() {
    const adminLinks = document.querySelectorAll('[data-requires-auth]');
    adminLinks.forEach((link) => {
      link.addEventListener("click", (event) => {
        const authed = sessionStorage.getItem(adminSessionKey) === "active";
        if (authed) return;

        event.preventDefault();
        const rawTarget = link.getAttribute("href") || "/blog.html";
        const normalized = rawTarget.startsWith("/") ? rawTarget : `/${rawTarget}`;
        const redirect = encodeURIComponent(normalized);
        location.href = `/admin.html?redirect=${redirect}`;
      });
    });
  }

  function renderFeed(list) {
    feedEl.innerHTML = "";
    list.forEach((item, idx) => {
      const articleUrl = `${location.origin}/blog-article.html?id=${idx}`;
      const shareUrl = buildOfficialLineShare(articleUrl);
      const card = document.createElement("article");
      card.className = "card";
      card.id = `post-${idx}`;
      card.innerHTML = `
        ${item.image ? `<img class="hero-img" src="${item.image}" alt="${item.title}">` : ""}
        <h3>${item.title}</h3>
        <p>${item.body}</p>
        <div class="meta">
          ${(item.tags || []).map(t => `<span class="tag">#${t}</span>`).join("") || '<span class="tag">#untagged</span>'}
        </div>
        <div class="share-row">
          <a class="share line" href="${shareUrl}" rel="noreferrer">公式LINEで共有</a>
          <a class="share" href="${articleUrl}">リンクを開く</a>
        </div>
      `;
      feedEl.appendChild(card);
    });
  }

  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("openLine").href = officialLinePage;
    enforceAdminLinks();
    const articles = loadArticles();
    renderFeed(articles);
    renderTicker(articles.flatMap(a => a.tags || []));
    renderMeta(articles.length);
  });
</script>
</body>
</html>
