<!doctype html>
<html lang="ja">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Emperor News — 公開ビュー</title>
<link rel="stylesheet" href="/assets/blog-shared.css">
<body>
  <header class="site-header">
    <div class="brand">
      <div class="logo">E</div>
      <div>
        <h1>Emperor News</h1>
        <p>公開ビュー / LINE共有 / モバイル最適化</p>
      </div>
    </div>
    <div class="actions">
      <a class="pill" href="/">トップ</a>
      <a class="pill" href="/blog-list.html">一覧ビュー</a>
      <a class="pill primary" id="openLine" target="_blank" rel="noreferrer">公式LINEで読む</a>
      <a class="pill ghost" href="/blog-edit.html" data-requires-auth="true">記事を編集</a>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <div class="inline-chips">
        <div class="badge">読者向け</div>
        <div class="badge">スマホ / タブレット / PC</div>
      </div>
      <h2>カードスタイルのニュースフィード</h2>
      <p>横スクロールの特集エリアと、タグ付きのカード一覧を刷新しました。スマホでは指でスワイプ、タブレットでは2列寄り、PCでは最大幅1200pxで広々表示します。</p>
      <div class="inline-chips" id="metaInfo"></div>
    </section>

    <section>
      <div class="ticker" aria-hidden="true">
        <div class="ticker-track" id="ticker"></div>
        <div class="ticker-track" id="tickerClone"></div>
      </div>
    </section>

    <section>
      <div class="section-title">
        <h2>特集</h2>
        <span class="muted">スマホは1枚ずつ、PCは複数カードを横並びで</span>
      </div>
      <div class="scroll-shell">
        <div class="scroll-track" id="featureTrack"></div>
      </div>
    </section>

    <section>
      <div class="section-title">
        <h2>最新記事</h2>
        <span class="muted">LINE共有ボタンとリンク付き</span>
      </div>
      <div class="card-grid" id="feed"></div>
    </section>
  </main>

<script src="/assets/blog-data.js"></script>
<script>
  const officialLinePage = "https://page.line.me/projecte_official";
  const feedEl = document.getElementById("feed");
  const ticker = document.getElementById("ticker");
  const tickerClone = document.getElementById("tickerClone");
  const featureTrack = document.getElementById("featureTrack");
  const metaInfo = document.getElementById("metaInfo");
  const adminSessionKey = "emperor_admin_token";
  const mobileQuery = window.matchMedia("(max-width: 720px)");

  function syncMobileClass(event) {
    const isMobile = event ? event.matches : mobileQuery.matches;
    document.body.classList.toggle("is-mobile", isMobile);
  }

  function renderTicker(tags) {
    const unique = Array.from(new Set(tags.length ? tags : ["iPhone", "iPad", "公式LINE", "黒ベース", "ChatGPTアップロード"]));
    const chips = unique.map(tag => `<div class="chip">#${tag}</div>`).join("");
    ticker.innerHTML = chips;
    tickerClone.innerHTML = chips;
  }

  function renderMeta(count) {
    metaInfo.innerHTML = `
      <span class="badge">公開中 ${count} 件</span>
      <span class="badge">LINE連携</span>
      <span class="badge">レスポンシブ</span>
    `;
  }

  function renderFeatures(list) {
    featureTrack.innerHTML = "";
    list.slice(0, 6).forEach((item, idx) => {
      const card = document.createElement("article");
      card.className = "article-card";
      card.innerHTML = `
        <div class="badge">特集 ${idx + 1}</div>
        ${item.image ? `<img class="hero-img" src="${item.image}" alt="${item.title}">` : ""}
        <h3>${item.title}</h3>
        <p>${item.body}</p>
        <div class="meta">${(item.tags || []).map(t => `<span class=\"tag\">#${t}</span>`).join("") || '<span class="tag">#untagged</span>'}</div>
      `;
      featureTrack.appendChild(card);
    });
  }

  function renderFeed(list) {
    feedEl.innerHTML = "";
    list.forEach((item, idx) => {
      const articleUrl = `${location.origin}/blog-article.html?id=${idx}`;
      const shareUrl = BlogData.buildOfficialLineShare(articleUrl);
      const card = document.createElement("article");
      card.className = "card";
      card.id = `post-${idx}`;
      card.innerHTML = `
        ${item.image ? `<img class="hero-img" src="${item.image}" alt="${item.title}">` : ""}
        <div class="inline-chips">
          <span class="badge">#${idx + 1}</span>
          <span class="badge">レスポンシブカード</span>
        </div>
        <h3>${item.title}</h3>
        <p>${item.body}</p>
        <div class="meta">${(item.tags || []).map(t => `<span class=\"tag\">#${t}</span>`).join("") || '<span class="tag">#untagged</span>'}</div>
        <div class="actions">
          <a class="share line" href="${shareUrl}" target="_blank" rel="noreferrer">公式LINEで共有</a>
          <a class="share" href="${articleUrl}" target="_blank">記事ページを開く</a>
        </div>
      `;
      feedEl.appendChild(card);
    });
  }

  function enforceAdminLinks() {
    const adminLinks = document.querySelectorAll('[data-requires-auth]');
    adminLinks.forEach((link) => {
      link.addEventListener("click", (event) => {
        const authed = sessionStorage.getItem(adminSessionKey) === "active";
        if (authed) return;

        event.preventDefault();
        const rawTarget = link.getAttribute("href") || "/blog-edit.html";
        const normalized = rawTarget.startsWith("/") ? rawTarget : `/${rawTarget}`;
        const redirect = encodeURIComponent(normalized);
        location.href = `/admin.html?redirect=${redirect}`;
      });
    });
  }

  document.addEventListener("DOMContentLoaded", () => {
    syncMobileClass();
    if (typeof mobileQuery.addEventListener === "function") {
      mobileQuery.addEventListener("change", syncMobileClass);
    } else if (typeof mobileQuery.addListener === "function") {
      mobileQuery.addListener(syncMobileClass);
    }
    document.getElementById("openLine").href = officialLinePage;
    enforceAdminLinks();
    const articles = BlogData.loadArticles();
    renderFeed(articles);
    renderFeatures(articles);
    renderTicker(articles.flatMap(a => a.tags || []));
    renderMeta(articles.length);
  });
</script>
</body>
</html>
